<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Spoken Language in Modern Media</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <!-- <script src="js/color.js"></script> -->
    <script src="js/composition.js"></script>
    <script src="js/graph.js"></script>
    <style>

    </style>
</head>
<body>
    <script>

        // Get page components
        const html = document.documentElement;
        const body = document.body;

        // Configure body size
        body.style.width = html.clientWidth + "px";
        body.style.height = html.clientHeight + "px";

        // Create container
        const root = new Container(body);

        // Add divisions

        const searchDiv = document.createElement("div");
        searchDiv.style.backgroundColor = "rgb(239, 239, 239)";
        root.add(Direction.RIGHT, searchDiv);

        const radialDiv = document.createElement("div");
        radialDiv.style.backgroundColor = "rgb(207, 207, 207)";
        root.add(Direction.RIGHT, radialDiv);

        const graphDiv = document.createElement("div");
        graphDiv.style.backgroundColor = "rgb(255, 255, 255)";
        root.add(Direction.BOTTOM, graphDiv);

        // Add figures

        function type(entry) {
            entry.year = parseInt(entry.year)
            entry.count = parseInt(entry.count)
            return entry
        }

        function render(entries) {

            // Split entries

            const tv_entries = entries.filter(function(entry) {
                return entry.source == "tv";
            });

            const movie_entries = entries.filter(function(entry) {
                return entry.source == "movie";
            });

            // Add associated movie_count to tv_entries

            for (const tv_entry of tv_entries) {
                tv_entry.movie_count = 0;
                for (const movie_entry of movie_entries) {
                    if (tv_entry.year == movie_entry.year) {
                        tv_entry.movie_count = movie_entry.count;
                    }
                }
            }

            // Configure scales

            const dimensions = get_dimensions(graphDiv);
            const width = dimensions.width;
            const height = dimensions.height - 5;

            const x_scale = d3.scale.linear()
                .domain(d3.extent(entries, function (entry) { return entry.year; }))
                .range([0, width]);

            const y_scale = d3.scale.linear()
                .domain(d3.extent(entries, function (entry) { return entry.count; }))
                .range([height, 0]);

            const color_scale = d3.scale.category10();

            // Create areas

            const tv_area = d3.svg.area()
                .x(function (entry) { return x_scale(entry.year); })
                .y0(function (entry) { return y_scale(entry.movie_count); })
                .y1(function (entry) { return y_scale(entry.count + entry.movie_count); });

            const movie_area = d3.svg.area()
                .x(function (entry) { return x_scale(entry.year); })
                .y0(height)
                .y1(function (entry) { return y_scale(entry.count); });

            // Create graph

            const graph = d3.select(graphDiv).append("svg")
                .attr("width", width + "px")
                .attr("height", height + "px");

            // Create paths

            const tv_path = graph.append("path")
                .attr("fill", color_scale("tv"))
                .attr("d", tv_area(tv_entries));
            
            const movie_path = graph.append("path")
                .attr("fill", color_scale("movie"))
                .attr("d", movie_area(movie_entries));
        }

        d3.csv("data/understand.csv", type, render);

        // Add resize callback

        window.onresize = function (event) {
            body.style.width = html.clientWidth + "px";
            body.style.height = html.clientHeight + "px";
            root.render();
        }

    </script>
</body>
</html>

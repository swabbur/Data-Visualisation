<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Spoken Language in Modern Media</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <!-- <script src="js/color.js"></script> -->
    <script src="js/composition.js"></script>
    <script src="js/graph.js"></script>
    <style>

    </style>
</head>
<body>
    <script>

        // Get page components
        const html = document.documentElement;
        const body = document.body;

        // Configure body size
        body.style.width = html.clientWidth + "px";
        body.style.height = html.clientHeight + "px";

        // Create container
        const root = new Container(body);

        // Add divisions

        const searchDiv = document.createElement("div");
        searchDiv.style.backgroundColor = "rgb(239, 239, 239)";
        root.add(Direction.RIGHT, searchDiv);

        const radialDiv = document.createElement("div");
        radialDiv.style.backgroundColor = "rgb(207, 207, 207)";
        root.add(Direction.RIGHT, radialDiv);

        const graphDiv = document.createElement("div");
        graphDiv.style.backgroundColor = "rgb(255, 255, 255)";
        root.add(Direction.BOTTOM, graphDiv);

        // Add figures

        function type(entry) {
            entry.year = parseInt(entry.year)
            entry.movie = parseInt(entry.movie)
            entry.tv = parseInt(entry.tv)
            entry.total = parseInt(entry.total)
            return entry
        }

        function render(entries) {

            // Configure scales

            const dimensions = get_dimensions(graphDiv);
            const width = dimensions.width;
            const height = dimensions.height - 4;

            const x_scale = d3.scale.linear()
                .domain(d3.extent(entries, function (entry) { return entry.year; }))
                .range([0, width]);

            const y_scale = d3.scale.linear()
                .domain(d3.extent(entries, function (entry) { return entry.total; }))
                .range([height - 40, 20]);

            const color_scale = d3.scale.category10();

            // Create areas

            const movie_area = d3.svg.area()
                .interpolate("cardinal")
                .x(function (entry) { return x_scale(entry.year); })
                .y0(height - 40)
                .y1(function (entry) { return y_scale(entry.movie); });

            const stacked_tv_area = d3.svg.area()
                .interpolate("cardinal")
                .x(function (entry) { return x_scale(entry.year); })
                .y0(function (entry) { return y_scale(entry.movie); })
                .y1(function (entry) { return y_scale(entry.total); });

            // Create graph

            const graph = d3.select(graphDiv).append("svg")
                .attr("width", width + "px")
                .attr("height", height + "px");

            // Create paths

            graph.append("path")
                .attr("fill", color_scale("movie"))
                .attr("d", movie_area(entries));

            graph.append("path")
                .attr("fill", color_scale("tv"))
                .attr("d", stacked_tv_area(entries));

            graph.append("rect")
                .attr("fill", "white")
                .attr("x", 0)
                .attr("y", height - 40)
                .attr("width", width)
                .attr("height", 40);

            graph.append("rect")
                .attr("fill", "black")
                .attr("x", 0)
                .attr("y", height - 40)
                .attr("width", width)
                .attr("height", 2);

            // Add x-axis

            const minmax = d3.extent(entries, function (entry) { return entry.year; });
            for (var year = minmax[0]; year < minmax[1]; year++) {
                if (year % 10 == 0) {

                    graph.append("rect")
                        .attr("fill", "black")
                        .attr("x", x_scale(year) - 1)
                        .attr("y", height - 40)
                        .attr("width", 3)
                        .attr("height", 7);
                    
                    graph.append("text")
                        .attr("fill", "black")
                        .attr("x", x_scale(year) - 20)
                        .attr("y", height - 10)
                        .attr("d", ".35em")
                        .text(year);
                }
            }
        }

        d3.csv("data/understand.csv", type, render);

        // Add resize callback

        window.onresize = function (event) {
            body.style.width = html.clientWidth + "px";
            body.style.height = html.clientHeight + "px";
            root.render();
        }

    </script>
</body>
</html>
